<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chapter Quiz</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <!-- Login Section -->
  <div id="loginSection" class="max-w-xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-4 text-center">Welcome to Chapter Quiz</h1>
    <p class="mb-4 text-center">Enter your details to begin</p>
    <input id="studentName" type="text" placeholder="Enter your name"
           class="border p-2 rounded w-full mb-3">
    <input id="schoolName" type="text" placeholder="Enter your school name"
           class="border p-2 rounded w-full mb-4">
    <button onclick="enterQuiz()" class="bg-blue-500 text-white px-4 py-2 rounded w-full">
      Continue
    </button>
  </div>

  <!-- Chapter Selection Section -->
  <div id="chapterSection" class="hidden max-w-xl mx-auto bg-white p-6 rounded shadow">
    <h2 class="text-xl font-semibold mb-4 text-center">Select a Chapter</h2>
    <div id="chaptersList" class="space-y-2 text-center">
      <p>Loading chapters...</p>
    </div>
  </div>

  <!-- Quiz Section -->
  <div id="quizSection" class="hidden max-w-2xl mx-auto bg-white p-6 rounded shadow">
    <h2 id="quizTitle" class="text-xl font-semibold mb-4"></h2>
    <div id="quizContainer"></div>
    <button onclick="submitQuiz()" 
            class="mt-4 bg-green-500 text-white px-4 py-2 rounded">Submit Quiz</button>
  </div>

  <!-- Result Section -->
  <div id="resultSection" class="hidden max-w-xl mx-auto bg-white p-6 rounded shadow text-center">
    <h2 class="text-xl font-semibold mb-4">Quiz Results</h2>
    <p id="resultText" class="mb-4"></p>
    <button onclick="goToChapters()" 
            class="bg-blue-500 text-white px-4 py-2 rounded">Back to Chapters</button>
  </div>

<script>
const APP_URL = "YOUR_DEPLOYMENT_URL"; // <-- Replace with Web App URL

let studentName = "";
let schoolName = "";
let currentChapter = "";
let questions = [];

function enterQuiz() {
  studentName = document.getElementById("studentName").value.trim();
  schoolName = document.getElementById("schoolName").value.trim();

  if (!studentName || !schoolName) {
    alert("Please enter your name and school name!");
    return;
  }

  document.getElementById("loginSection").classList.add("hidden");
  document.getElementById("chapterSection").classList.remove("hidden");

  loadChapters();
}

function loadChapters() {
  fetch(APP_URL + "?mode=chapters")
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById("chaptersList");
      container.innerHTML = "";
      if (data.chapters && data.chapters.length) {
        data.chapters.forEach(ch => {
          const btn = document.createElement("button");
          btn.textContent = ch;
          btn.className = "block w-full bg-gray-200 hover:bg-blue-300 px-4 py-2 rounded";
          btn.onclick = () => startQuiz(ch);
          container.appendChild(btn);
        });
      } else {
        container.innerHTML = "<p>No chapters found.</p>";
      }
    })
    .catch(err => {
      document.getElementById("chaptersList").innerHTML =
        `<p class="text-red-500">Error loading chapters: ${err}</p>`;
    });
}

function startQuiz(chapter) {
  currentChapter = chapter;
  document.getElementById("chapterSection").classList.add("hidden");
  document.getElementById("quizSection").classList.remove("hidden");
  document.getElementById("quizTitle").textContent = "Quiz: " + chapter;

  fetch(APP_URL + "?mode=questions&chapter=" + encodeURIComponent(chapter))
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById("quizContainer");
      container.innerHTML = "";
      questions = data.questions || [];
      if (!questions.length) {
        container.innerHTML = "<p>No questions available for this chapter.</p>";
        return;
      }
      questions.forEach((q, i) => {
        const qDiv = document.createElement("div");
        qDiv.className = "mb-4";
        qDiv.innerHTML = `<p class="font-medium mb-2">${i + 1}. ${q.question}</p>`;
        q.options.forEach(opt => {
          const optId = `q${i}_${opt}`;
          qDiv.innerHTML += `
            <label class="block">
              <input type="radio" name="q${i}" value="${opt}" class="mr-2"> ${opt}
            </label>`;
        });
        container.appendChild(qDiv);
      });
    })
    .catch(err => {
      document.getElementById("quizContainer").innerHTML =
        `<p class="text-red-500">Error loading questions: ${err}</p>`;
    });
}

function submitQuiz() {
  let score = 0;
  const answers = {};
  questions.forEach((q, i) => {
    const selected = document.querySelector(`input[name="q${i}"]:checked`);
    const ans = selected ? selected.value : "";
    answers[q.id] = ans;
    if (ans === q.correct) score++;
  });

  fetch(APP_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "submitQuiz",
      name: studentName,
      school: schoolName,
      chapter: currentChapter,
      score,
      total: questions.length,
      answers
    })
  });

  document.getElementById("quizSection").classList.add("hidden");
  document.getElementById("resultSection").classList.remove("hidden");
  document.getElementById("resultText").textContent =
    `Hi ${studentName} from ${schoolName}, you scored ${score} out of ${questions.length}.`;
}

function goToChapters() {
  document.getElementById("resultSection").classList.add("hidden");
  document.getElementById("chapterSection").classList.remove("hidden");
}
</script>
</body>
</html>
